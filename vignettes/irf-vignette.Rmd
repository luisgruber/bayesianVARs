---
title: "Compute Impulse Response Functions to Structural Shocks using **bayesianVARs**"
author: Stefan Haan^[University of Klagenfurt, mailto:sthaan@edu.aau.at]
output: html_document
bibliography: irfs.bib
link-citations: true
reference-section-title: References
vignette: >
  %\VignetteIndexEntry{Compute Impulse Response Functions to Structural Shocks using **bayesianVARs**}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

The structural VAR model of order $p$ assumes the vector-valued observations $\left\{ y_t , t = 1, \dots, T \right\}$ are generated by the process^[We suppress the intercept of the equation.]
\begin{equation*}
	y_t' B_0 = y_{t-1}' B_1 + \dots + y_{t-p}' B_p + \omega_t'.
\end{equation*}
The components of $\omega_t$ are required to be uncorrelated (i.e., the variance-covariance matrix $\Sigma_{\omega}$ is a diagonal matrix) and referred to as _structural shocks_.

The model parameter $B_0$ is not identified. The model deserves to be called "structural", only if $B_0$ reflects the instantaneous causal relationships between the variables. Theoretical considerations are used to place restrictions on the entries of $B_0$ [@luetkepohl2005, Section 10.2.2]. Following [@rubioramirez2010] and [@arias2014], in order to identify $B_0$, we allow the user to specify identifying zero and sign restrictions for several transformations of the structural parameters:

- $B_0$ itself,
- the contemporaneous effects $\mathrm{IR}_0 := B_0'^{-1}$,
- the structural coefficients $B_1, B_2, \dots, B_p$, and
- the long-run effects (sum of the impulse responses over all horizons $h$)
\begin{equation*}
\mathrm{IR}_\infty := \left(B_0' - \sum_{l=1}^{p} B_l' \right)^{-1}.
\end{equation*}

An _impulse response function_ describes the effects of an shock to the system over time.
Intuitively, IRFs answer the question: "What is the effect of a shock $\varepsilon_t$ hitting the system at time $t$ on
$y_{t+h}$ for $h = 1,2,\dots$, given that no other shocks hit the system?" [@koop1996].
Formally, we define IRFs as the Jacobian
\begin{equation*}
	\Theta_h := \frac{\partial y_{t+h}}{\partial \omega_t'}
\end{equation*}

If the (homoskedastic) factor model is used, we define the impulse reponses with respect to innovations in the factors $f_t$ instead:
\begin{equation*}
\frac{\partial y_{t+h}}{\partial f_t'}
\end{equation*}
In this case, identification of the IRFs is achieved by zero and sign restrictions on the factor loadings $\Lambda$ (which are also the contemporaneous effects $\mathrm{IR}_0$) and/or the long-run effects.

One outstanding feature of **bayesianVARs** is the ability to account for time-varying innovation variances using the _stochastic volatility_ models implemented in **stochvol** and **factorstochvol** [@vigbayesianVARs:bayesianVARs-vignette]. For these models however, all columns of $B_0$ are already identified up to sign [@lutkepohl2024]. This result generalizes to the VAR model with factor stochastic volatility [@thesishaan2025, Theorem 2]. If a heteroskedastic model is fitted with `bvar` (the default), the function `irf` uses the estimated innovation variances at time $T$.

# Usage examples
We present several practical examples in **R** that show how **bayesianVARs** can be used to obtain IRFs. The example [Optimism shocks](#optimism-shocks) is intended to show typical usage and reproduces Figure 4(a) from [@arias2014]. In the example "A Monetary SVAR" we show how to relax restrictions that cannot be satisfied. In particular, we replace a zero restriction with a custom "approximately zero restriction" using rejection sampling.
	
## Optimism shocks
[@beaudry2011] analyze the relevance of optimism shocks on business cycle phenomena such as a boom in output, investment, consumption, and hours worked.	[@beaudry2011] propose several identification schemes for optimism shocks. All identification schemes have in common that an optimism shock should be associated with an increase in stock prices. Additionally, the optimism shock should not be associated with improvements in technology (measured by _total factor productivity_) or expansionary monetary policy, which can be competing causes for an increase in stock prices. The most agnostic identification scheme imposes only a zero restriction on productivity and a positive sign restriction on stock prices on the contemporaneous effects.
	
[@arias2014] criticize the approach used by [@beaudry2011] to calculate the IRFs for its upward bias and artificially narrow confidence intervals, and come to the conclusion that the reported results are not significant, if the IRFs are drawn from the correct distribution. [@bsvarSIGNs] replicate this using the R package **bsvarSIGNs**. In this example we replicate this result once more using **bayesianVARs**.

First, we load the `optimism` dataset from the **bsvarSIGNs** package.
```{r, message=FALSE}
library(bsvarSIGNs)
data(optimism)
```

We then fit a homoskedastic $\mathrm{VAR}(4)$ model using **bayesianVARs**.
```{r, results="hide", cache=TRUE}
library(bayesianVARs)
prior_sigma <- specify_prior_sigma(
	M = ncol(optimism),
	type = "cholesky",
	cholesky_heteroscedastic = FALSE
)
mod <- bvar(optimism * 100, lags = 4L, prior_sigma = prior_sigma)
```

We construct following matrix describing the zero and sign restrictions on the contemporaneous effects.
```{r, echo=FALSE}
restrictions <- matrix(
	NA, ncol(optimism), ncol(optimism),
	dimnames=list(colnames(optimism), paste0("shock", 1:ncol(optimism)))
)
restrictions["productivity", "shock1"] <- 0
restrictions["stock_prices", "shock1"] <- 1
```
```{r}
show(restrictions)
```
Here, `NA` signifies an unrestricted parameter, `0` a zero restriction on the parameter and `1` imposes a positive sign restriction.
Since shocks 2-5 are not identified, we calculate IRFs only for the first shock.
```{r}
#| calculate-optimism-irfs, cache=TRUE,
#| fig.width=4, fig.cap="IRFs to an one standard-deviation optimism shock."

shock1 <- as.matrix(diag(ncol(optimism))[,1])
show(shock1)

struct_restr <- specify_structural_restrictions(
	mod,
	restrictions_B0_inv_t = restrictions
)
shock1_irf <- irf(
	mod,
	ahead = 40,
	structural_restrictions = struct_restr,
	shocks = shock1
)

plot(shock1_irf, quantiles = c(0.16, 0.50, 0.84))
```
The 68% confidence intervals we compute resemble the intervals shown in [@arias2014, Figure~4(a)]. We can see that the confidence intervals of consumption and hours worked include zero at all times. The optimism shock identified in this manner has therefore no statistically significant effect on any of the these variables in our model. Stock prices seem to be highly persistent, with significant effects for at least 40 periods after the initial shock.

## A Monetary SVAR
```{tikz}
\usetikzlibrary{positioning}
\begin{tikzpicture}
	\node (Y) {$Y$}; \node[above=0.2 of Y] (w1) {PS};
	\node[below=of Y] (P) {$P$}; \node[left=0.2 of P] (w2) {PS};
	\node[right=of Y] (M) {$M$}; \node[above=0.2 of M] (w3) {MD};
	\node[below right=of M] (R) {$R$}; \node[above=0.2 of R] (w4) {MP};
	\node[below right=of P] (Pc) {$P_c$}; \node[below=0.2 of Pc] (w5) {Inf};
	
	\draw [->] (Y) edge (P);
	\draw [<->] (M) edge (R);
	\draw [->] (Y) edge (M);
	\draw [->] (P) edge (M);
	\draw [->] (Y) edge (Pc);
	\draw [->] (P) edge (Pc);
	\draw [->] (R) edge (Pc);
	\draw [->] (M) edge (Pc);
	
	\draw [->] (w1) edge (Y);
	\draw [->] (w2) edge (P);
	\draw [->] (w3) edge (M);
	\draw [->] (w4) edge (R);
	\draw [->] (w5) edge (Pc);
\end{tikzpicture}
```
